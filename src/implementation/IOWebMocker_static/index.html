<!DOCTYPE html>
<html lang="pt-br" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Emulador de IOs</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">        
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.3/socket.io.js"></script>
        

    <style>
      .led {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 2em;
        height: 2em;
        border-radius: 2em 2em 2em 2em;
        border: 1px solid lightgray;
        background-image: linear-gradient(
          to top right,
          rgb(211, 211, 211, 0.5)
        );
      }

      .red {
        background-image: linear-gradient(
          to top right,
          rgba(255, 50, 50, 0.5) 20%,
          rgba(255, 50, 50, 0.3) 60%,
          rgba(255, 50, 50, 0.2)
        ) !important;
      }

      .green {
        background-image: linear-gradient(
          to top right,
          rgba(50, 255, 50, 0.5) 20%,
          rgba(50, 255, 50, 0.3) 60%,
          rgba(50, 255, 50, 0.2)
        ) !important;
      }

      .blue {
        background-image: linear-gradient(
          to top right,
          rgba(50, 50, 255, 0.5) 20%,
          rgba(50, 50, 255, 0.3) 60%,
          rgba(50, 50, 255, 0.2)
        ) !important;
      }

      .l0 {
        background-color: #000000;
      }

      .l1 {
        background-color: #101010;
      }

      .l2 {
        background-color: #202020;
      }

      .l2-blue {
        background-color: #181828;
      }

      .l3 {
        background-color: #303030;
      }
    </style>

    <script>
        $(document).ready(function (){
            var socket_main_server = io.connect('http://' + document.domain + ':50000');
            var socket_io_mocker = io.connect('http://' + document.domain + ':50001');
            
            
            socket_main_server.on('IO_update', function(new_IO_state) {
                console.group("IO_update")
                console.log(new_IO_state)
                console.groupEnd()
                
                for (const [key, value] of Object.entries(new_IO_state["digital_inputs"])) {
                    $('#' + key).attr('class', value ? 'input_led led green' : 'input_led led red');
                }
                for (const [key, value] of Object.entries(new_IO_state["digital_outputs"])) {
                    $('#' + key).attr('class', value ? 'led green' : 'led red');
                }
            });

            $('.input_led').click(function(){
                let new_state = !($(this).hasClass("green"))
                let id = $(this).attr('id')
                input_update = {}
                input_update[id] = new_state
                socket_io_mocker.emit("input_update",input_update)


                $(this).removeClass(new_state?"red":"green")
                $(this).addClass(new_state?"green":"red")


                console.log(input_update)
            });
        })
    </script>
  </head>
  <body>
    <div
      id="IO_monitor"
      class="m-2 border justify-content-center rounded l1"
    >
      <h2 class="text-center">Emulador de IOs</h2>
      <div class="m-2 p-2 border rounded l2">
        <h6 class="text-center">Entradas</h6>
        <div class="d-flex flex-row justify-content-around rounded">
          <div class="input_led led" id="i0">i0</div>
          <div class="input_led led" id="i1">i1</div>
          <div class="input_led led" id="i2">i2</div>
          <div class="input_led led" id="i3">i3</div>
          <div class="input_led led" id="i4">i4</div>
          <div class="input_led led" id="i5">i5</div>
          <div class="input_led led" id="i6">i6</div>
          <div class="input_led led" id="i7">i7</div>
          <div class ="input_led led" id="i8">i8</div>
          <div class ="input_led led" id="i9">i9</div>
          <div class ="input_led led" id="i10">i10</div>
          <div class ="input_led led" id="i11">i11</div>
          <div class ="input_led led" id="i12">i12</div>
          <div class ="input_led led" id="i13">i13</div>
          <div class ="input_led led" id="i14">i14</div>
          <div class ="input_led led" id="i15">i15</div>
        </div>
      </div>
      <div class="m-2 p-2 border rounded l2">
        <h6 class="text-center">Sa√≠das</h6>
        <div class="d-flex flex-row justify-content-around rounded">
          <div class="led" id="o0">o0</div>
          <div class="led" id="o1">o1</div>
          <div class="led" id="o2">o2</div>
          <div class="led" id="o3">o3</div>
          <div class="led" id="o4">o4</div>
          <div class="led" id="o5">o5</div>
          <div class="led" id="o6">o6</div>
          <div class="led" id="o7">o7</div>
          <div class ="led" id="o8">o8</div>
          <div class ="led" id="o9">o9</div>
          <div class ="led" id="o10">o10</div>
          <div class ="led" id="o11">o11</div>
          <div class ="led" id="o12">o12</div>
          <div class ="led" id="o13">o13</div>
          <div class ="led" id="o14">o14</div>
          <div class ="led" id="o15">o15</div>
        </div>
      </div>
    </div>
  </body>
</html>
